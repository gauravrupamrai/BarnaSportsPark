service: backend
frameworkVersion: "3"

plugins:
  - serverless-dotenv-plugin
  - serverless-offline
  - serverless-finch

provider:
  name: aws
  runtime: nodejs18.x
  memorySize: 128
  region: eu-west-1
  stage: ${opt:stage, 'dev'}
  apiName: UserSignupLoginApi
  endpointType: REGIONAL
  iamRoleStatements:
    - Effect: Allow
      Action:
        - ses:* # Allows all SES actions
      Resource: "*" # Allows all resources
  apiGateway:
    apiKeys:
      - bspSignupLogin
      - ${opt:stage, 'dev'}-bspSignupLogin
    usagePlan:
      quota:
        limit: 5000
        offset: 2
        period: MONTH
      throttle:
        burstLimit: 200
        rateLimit: 100

custom:
  client:
    bucketName: barnasportspark.com
    bucketRegion: eu-west-1
    distributionFolder: ../frontend/build
    indexDocument: index.html


functions:
  ## Health Check function
  healthCheck:
    handler: src/apis/signupLogin.handler
    events:
      - http:
          path: /health
          method: GET
          cors: true
          private: true
    timeout: 90

  ## Register Function
  register:
    handler: src/apis/signupLogin.handler
    events:
      - http:
          path: /register
          method: POST
          cors: true
          private: true
    timeout: 90

  ## Login Function
  login:
    handler: src/apis/signupLogin.handler
    events:
      - http:
          path: /login
          method: POST
          cors: true
          private: true
    timeout: 90

  ## Verify Function
  verify:
    handler: src/apis/signupLogin.handler
    events:
      - http:
          path: /verify
          method: POST
          cors: true
          private: false
    timeout: 90

  ## Activation Function
  activate:
    handler: src/apis/signupLogin.handler
    events:
      - http:
          path: /activate
          method: GET
          cors: true
          private: false
    timeout: 90

  ## Email Function
  sendEmail:
    handler: src/apis/externalConn.handler
    events:
      - http:
          path: send-Email
          method: POST
          cors: true
          private: true

            
  createNotice:
    handler: src/apis/adminFunctions.handler
    events:
      - http:
          path: /create-notice
          method: POST
          cors: true
          private: true
    timeout: 90

  getNotices:
    handler: src/apis/adminFunctions.handler
    events:
      - http:
          path: /get-notices
          method: GET
          cors: true
          private: true
    timeout: 90
  
  getNoticeForHome:
    handler: src/apis/adminFunctions.handler
    events:
      - http:
          path: /get-notice-for-home
          method: GET
          cors: true
          private: true
    timeout: 90

  userProfileUpdate:
    handler: src/apis/userFunctions.handler
    events:
      - http:
          path: /user-profile-update
          method: POST
          cors: true
          private: true
    timeout: 90
  
  userNewMembership:
    handler: src/apis/userFunctions.handler
    events:
      - http:
          path: /user-new-membership
          method: POST
          cors: true
          private: true
    timeout: 90

  testApi:
    handler: src/apis/userFunctions.handler
    events:
      - http:
          path: /test-api
          method: POST
          cors: true
          private: true
    timeout: 90

